@model TaskManagementMvc.Controllers.RegisterViewModel
@{
    Layout = null; // صفحه بدون لایوت
}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ثبت‌نام</title>
    <!-- Bootstrap RTL & Icons & Font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f6f7fb; --card: #ffffff; }
        body { background: var(--bg); font-family: "Vazirmatn", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
        .auth-shell { min-height: 100vh; display: grid; place-items: center; padding: 24px; }
        .step-card { width: 100%; max-width: 640px; background: var(--card); border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.08); overflow: hidden; }
        .step-header { padding: 16px 20px; background: #0d6efd; color: #fff; display: flex; align-items: center; gap: .5rem; }
        .step-header .title { font-size: 1.1rem; margin: 0; }
        .stepper { display: flex; justify-content: space-between; gap: 12px; padding: 16px 20px; background: #f0f4ff; }
        .stepper .node { flex: 1 1 0; display: flex; align-items: center; gap: 10px; opacity: .6; font-weight: 500; }
        .stepper .node.active { opacity: 1; }
        .stepper .dot { width: 28px; height: 28px; border-radius: 50%; background: #dbe5ff; color: #0d6efd; display: grid; place-items: center; font-weight: 700; }
        .stepper .node.active .dot { background: #0d6efd; color: #fff; }
        .step-body { padding: 20px; }
        .actions { display: flex; gap: 10px; justify-content: space-between; padding: 16px 20px; border-top: 1px solid #eee; background: #fafbff; }
        .actions .left, .actions .right { display: flex; gap: 10px; }
        .brand { text-align: center; color: #6c757d; margin-top: 10px; font-size: .9rem; }
    </style>
    <meta name="robots" content="noindex,nofollow" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>
<body>
    <div class="auth-shell">
        <div class="step-card">
            <div class="step-header">
                <i class="bi bi-person-plus fs-5"></i>
                <h1 class="title">ثبت‌نام</h1>
            </div>

            <div class="stepper">
                <div class="node" id="node-1">
                    <div class="dot">۱</div>
                    <div>اطلاعات کاربر</div>
                </div>
                <div class="node" id="node-2">
                    <div class="dot">۲</div>
                    <div>اطلاعات شرکت</div>
                </div>
            </div>

            <form id="registerForm" asp-action="Register" method="post" novalidate>
                @Html.AntiForgeryToken()
                <div class="step-body">
                    <div asp-validation-summary="ModelOnly" class="text-danger small mb-2"></div>

                    <!-- Step 1: User info -->
                    <div id="step-1" class="step-panel">
                        <div class="mb-3">
                            <label asp-for="FullName" class="form-label"></label>
                            <input asp-for="FullName" class="form-control" />
                            <span asp-validation-for="FullName" class="text-danger small"></span>
                        </div>
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <label asp-for="Email" class="form-label"></label>
                                <input asp-for="Email" class="form-control" />
                                <span asp-validation-for="Email" class="text-danger small"></span>
                            </div>
                            <div class="col-12 col-md-6"></div>
                            <div class="col-12 col-md-6">
                                <label asp-for="Password" class="form-label"></label>
                                <input asp-for="Password" class="form-control" />
                                <span asp-validation-for="Password" class="text-danger small"></span>
                            </div>
                            <div class="col-12 col-md-6">
                                <label asp-for="ConfirmPassword" class="form-label"></label>
                                <input asp-for="ConfirmPassword" class="form-control" />
                                <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Company info (only required field) -->
                    <div id="step-2" class="step-panel" style="display:none;">
                        <div class="mb-3">
                            <label asp-for="CompanyName" class="form-label"></label>
                            <input asp-for="CompanyName" class="form-control" />
                            <span asp-validation-for="CompanyName" class="text-danger small"></span>
                        </div>
                        <!-- اختیاری‌ها (توضیحات/تلفن) به درخواست شما حذف شد -->
                    </div>
                </div>

                <div class="actions">
                    <div class="left">
                        <a class="btn btn-outline-secondary" asp-action="Login"><i class="bi bi-box-arrow-in-right ms-1"></i> ورود</a>
                    </div>
                    <div class="right">
                        <button type="button" id="btnPrev" class="btn btn-light" style="display:none;">بازگشت</button>
                        <button type="button" id="btnNext" class="btn btn-primary">ادامه</button>
                        <button type="submit" id="btnSubmit" class="btn btn-success" style="display:none;">ثبت‌نام</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="brand">© <span id="year"></span> TaskManagement</div>
    </div>

    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script>
        (function() {
            const form = document.getElementById('registerForm');
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const node1 = document.getElementById('node-1');
            const node2 = document.getElementById('node-2');
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const btnSubmit = document.getElementById('btnSubmit');
            const year = document.getElementById('year'); year.textContent = new Date().getFullYear();

            let current = 1;
            function setStep(n) {
                current = n;
                step1.style.display = n === 1 ? '' : 'none';
                step2.style.display = n === 2 ? '' : 'none';
                node1.classList.toggle('active', n === 1);
                node2.classList.toggle('active', n === 2);
                btnPrev.style.display = n === 2 ? '' : 'none';
                btnNext.style.display = n === 1 ? '' : 'none';
                btnSubmit.style.display = n === 2 ? '' : 'none';
            }

            function validateVisible() {
                // jQuery unobtrusive validate ignores hidden fields
                if (window.jQuery && window.jQuery.validator) {
                    const v = jQuery(form).validate();
                    return v.form();
                }
                return true;
            }

            btnNext.addEventListener('click', function() {
                if (!validateVisible()) return;
                setStep(2);
            });
            btnPrev.addEventListener('click', function() { setStep(1); });

            // Prevent submitting the form with Enter on step 1
            form.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && current === 1) {
                    e.preventDefault();
                    btnNext.click();
                }
            });

            // On submit, validate all fields; if any invalid, navigate to its step
            form.addEventListener('submit', function(e) {
                if (window.jQuery && window.jQuery.validator) {
                    const v = jQuery(form).validate();
                    const prevIgnore = v.settings.ignore;
                    v.settings.ignore = []; // validate hidden fields too
                    const ok = v.form();
                    if (!ok) {
                        e.preventDefault();
                        if (v.errorList && v.errorList.length) {
                            const el = v.errorList[0].element;
                            if (step1.contains(el)) setStep(1); else setStep(2);
                        }
                    }
                    v.settings.ignore = prevIgnore;
                }
            });

            // Default: highlight first step
            setStep(1);
        })();
    </script>
    <!-- Optional: Bootstrap JS (not required for our simple stepper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>try { if (bootstrap) {} } catch (e) { /* ignore */ }</script>
</body>
</html>
